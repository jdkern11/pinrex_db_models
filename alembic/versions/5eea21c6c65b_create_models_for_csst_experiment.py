"""create models for CSST experiment

Revision ID: 5eea21c6c65b
Revises: efcf610d4b33
Create Date: 2023-03-09 12:04:32.055055

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '5eea21c6c65b'
down_revision = 'efcf610d4b33'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('csst_experiments',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('file_name', sa.Text(), nullable=True),
    sa.Column('version', sa.Text(), nullable=False),
    sa.Column('experimental_details', sa.Text(), nullable=True),
    sa.Column('experiment_number', sa.Text(), nullable=True),
    sa.Column('project', sa.Text(), nullable=True),
    sa.Column('lab_journal', sa.Text(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('start_of_experiment', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('csst_properties',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('name', sa.Text(), nullable=False),
    sa.Column('unit', sa.Text(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('csst_temperature_programs',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('block', sa.Text(), nullable=False),
    sa.Column('solvent_tune', sa.JSON(), nullable=False),
    sa.Column('sample_load', sa.JSON(), nullable=False),
    sa.Column('experiment', sa.JSON(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('csst_reactors',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('sol_id', sa.Integer(), nullable=False),
    sa.Column('pol_id', sa.Integer(), nullable=False),
    sa.Column('csst_temperature_program_id', sa.Integer(), nullable=False),
    sa.Column('csst_experiment_id', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['csst_experiment_id'], ['csst_experiments.id'], ),
    sa.ForeignKeyConstraint(['csst_temperature_program_id'], ['csst_temperature_programs.id'], ),
    sa.ForeignKeyConstraint(['pol_id'], ['polymers.id'], ),
    sa.ForeignKeyConstraint(['sol_id'], ['solvents.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('csst_property_multiple_values',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('csst_property_id', sa.Integer(), nullable=False),
    sa.Column('csst_reactor_id', sa.Integer(), nullable=False),
    sa.Column('array_index', sa.Integer(), nullable=False),
    sa.Column('value', sa.Float(), nullable=False),
    sa.ForeignKeyConstraint(['csst_property_id'], ['csst_properties.id'], ),
    sa.ForeignKeyConstraint(['csst_reactor_id'], ['csst_reactors.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('csst_property_single_values',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('csst_property_id', sa.Integer(), nullable=False),
    sa.Column('csst_reactor_id', sa.Integer(), nullable=False),
    sa.Column('value', sa.Float(), nullable=False),
    sa.ForeignKeyConstraint(['csst_property_id'], ['csst_properties.id'], ),
    sa.ForeignKeyConstraint(['csst_reactor_id'], ['csst_reactors.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.drop_column('solubility_data', 'csst_file')
    op.drop_table('csst_files')
    op.create_unique_constraint(None, 'genes', ['uniprot_id'])
    op.drop_constraint('solnet_data_csst_file_fkey', 'solubility_data', type_='foreignkey')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'genes', type_='unique')
    op.create_table('csst_files',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('file_name', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('polymers', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('solvents', postgresql.ARRAY(sa.TEXT()), autoincrement=False, nullable=True),
    sa.Column('concentrations', postgresql.ARRAY(postgresql.DOUBLE_PRECISION(precision=53)), autoincrement=False, nullable=True),
    sa.Column('date_added', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=False),
    sa.Column('stir_rate', postgresql.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('start_of_experiment', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('version', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('project', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('original_name', sa.TEXT(), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('id', name='csst_files_pkey'),
    sa.UniqueConstraint('file_name', name='csst_files_file_name_key')
    )
    op.add_column('solubility_data', sa.Column('csst_file', sa.INTEGER(), autoincrement=False, nullable=True))
    op.create_foreign_key('solnet_data_csst_file_fkey', 'solubility_data', 'csst_files', ['csst_file'], ['id'])
    op.drop_table('csst_property_single_values')
    op.drop_table('csst_property_multiple_values')
    op.drop_table('csst_reactors')
    op.drop_table('csst_temperature_programs')
    op.drop_table('csst_properties')
    op.drop_table('csst_experiments')
    # ### end Alembic commands ###
